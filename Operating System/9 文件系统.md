## 文件系统
**理解文件系统特点与文件组织，掌握文件系统的基本数据结构，了解文件、目录的基本性质及其实现方法；重点掌握磁盘空间的管理、文件系统的性能及可靠性、文件系统的安全性及保护机制等。**

### 文件系统特点与文件组织方式
用户将数据组织成文件，根据文件名来访问对应的数据。文件系统是对持久化数据存储的抽象，即给用户/程序开发者提供一个逻辑上的持久化存储。  
系统中的所有文件都存在着两种形式的文件结构：文件的逻辑结构和文件的物理结构。文件的逻辑结构从文件的组织方式来分，可以分为三类：顺序文件（由一系列记录按某种顺序排列所形成的文件）、索引文件（为可变长记录文件建立一张索引表，每个记录设置一个表项）和索引顺序文件（为一组记录中的第一个记录建立一个索引表项）。

### 文件系统的数据结构
#### 超级块
* 需要定义一个文件系统。包含数据块和 i-node 的大小、总数，根目录的 ino，i-node 表起始地址，空闲数据块和 i-node 指针。
* 还有文件系统当前的使用状态。包含数据块和 i-node 的使用情况。

#### 文件控制块
文件控制块（FCB）用来存放控制文件需要的各种信息。主要包含：
* 基本信息：文件名、文件的物理位置、文件的逻辑结构和物理结构等。
* 存取控制信息：文件存取权限等。
* 使用信息：文件建立时间、修改时间等。

#### 索引结点
在检索目录文件的过程中，只用到了文件名，其它信息不需要调入内存。因此 UNIX 等系统将文件描述信息单独形成一个成为索引结点的结构，简称为 i 结点。

### 目录
UNIX 系统中每个目录项仅由文件名和指向该文件所对应的 i 结点的指针组成，在逻辑上是一张映射表，实际上是一种特殊的文件。

### 磁盘空间的管理
#### 连续组织方式
为每一个文件分配一组相邻的盘块。
* 优点：顺序访问容易；顺序访问速度快。
* 缺点：会产生外部碎片，降低空间利用率；必须事先知道文件的长度；不能灵活地删除和插入记录；对于动态增长的文件，很难为其分配空间。

#### 链接组织方式
* 隐式链接：文件目录的每个目录项中，都有指向链接文件第一个盘块和最后一个盘块的指针；每个盘块中都含有一个指向下一个盘块的指针。只适用于顺序访问。
* 显示链接：把用于链接文件各物理块的指针显示地存放在内存的一张链接表中。把该表称为文件分配表 FAT。
* 优点：消除了磁盘的外部碎片；插入、删除和修改记录都非常容易；能适应文件的动态增长。
* 缺点：不能支持高效的直接存取；FAT 需占用较大的内存空间。

#### 索引组织方式
* 单级索引组织方式：为每个文件分配一个索引块（表），把分配给该文件的所有盘块号都记录在该索引块中。支持直接访问。对于小文件索引块利用率极低。
* 多级索引组织方式：当文件较大时，需要多个索引块；此时可为索引块再分配一个索引块，称为二级索引。加快了对大型文件的查找速度。启动磁盘的次数随着索引级数的增加而增多。
* 增量式索引组织方式：对于小型文件，可以将文件块地址都直接放入 FCB 或 i 结点中，称为直接寻址；对于中等文件，可采用单级索引组织，也称为一次间址；对于大型和特大型文件，可以采用两级和三级索引组织方式，称为二次间址和三次间址。
