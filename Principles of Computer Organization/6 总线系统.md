## 总线系统
**掌握总线系统的基本概念和基本技术以及总线仲裁方式的基本工作原理和特点，了解 PCI 总线的特点。**

### 总线概述
#### 总线的基本概念
总线是连接各个部件的信息传输线，是各个部件共享的传输介质。

#### 总线结构形态
* 单总线结构：将 CPU、主存和各 I/O 设备都挂到一组总线上。
* 多总线结构：
    * 双总线结构：将速度较低的 I/O 设备从单总线上分离出来，形成主存总线与 I/O 总线分开的结构。
    * 三总线结构：
        * 主存总线用于 CPU 与主存之间的传输，I/O 总线供 CPU 与各类 I/O 设备之间传输信息，DMA 总线用于高速 I/O 设备与主存之间直接交换信息。
        * 处理器与 Cache 之间有一条局部总线，将 CPU 与 Cache 或与更多的局部设备连接。Cache 不仅连接到局部总线上，也直接连到系统总线上。还有一条扩展总线，将局域网、小型计算机接口（SCSI）、调制解调器（Modem）以及串行接口等都连接起来，并通过扩展总线接口与系统总线相连。
    * 四总线结构：在第二种三总线结构的基础上增加一条与计算机系统紧密相连的高速总线，挂接高速 I/O 设备，如高速局域网、图形工作站、多媒体、SCSI等，通过 Cache 控制机构中的高速总线桥或高速缓冲器与系统总线和局部总线相连。低速设备仍挂在扩展总线上，并通过扩展总线结构与高速总线相连。

#### 总线的组成
* 机械特性：尺寸、形状、管脚数即排列顺序。
* 电气特性：传输方向和有效的电平范围。
* 功能特性：每根传输线的功能，传递地址/数据/控制。
* 时间特性：信号的时序关系，用时序图描述。

#### 总线的性能指标
* 总线宽度：数据线的根数。
* 总线带宽：每秒传输的最大字节数（MBps）。
* 时钟同步/异步：数据与时钟同步/不同步。
* 总线复用：地址线与数据线复用。
* 信号线数：地址总线、数据总线和控制总线的总和。
* 总线控制方式：突发工作、自动配置、仲裁方式、逻辑方式、技术方式等。
* 其他指标：负载能力、电源电压、总线宽度能否扩展等。

### 总线仲裁
为了正确地实现多个部件之间的通信，必须有一个总线控制机构，来对总线的使用进行合理的分配和管理。

#### 集中仲裁方式
总线控制逻辑基本集中在一处。
* 链式查询方式：主要有三根控制线：BS（总线忙），BR（总线请求），BG（总线同意）。其中 BG 是串行地从一个 I/O 接口送到下一个 I/O 接口，如果 BG 到达的接口有总线请求，就不再往下传，意味着该接口获得了总线使用权，并建立总线忙信号。  
    只需很少几根线就能按一定优先次序实现总线控制，容易扩充设备；但对电路故障很敏感，优先级低的设备可能很难获得请求。

* 计数器定时查询方式：与链式查询相比多了一组设备地址线，少了一根总线同意线。总线控制部件接到请求信号后，其中的计数器开始计数，并向各设备发出地址信号。当某个请求占用总线的设备地址与计数值一致时获得总线使用权，终止计数查询。  
    计数初始值可以每次都为0、可以为上一次的终止点也可以由程序设定，对电路故障不如链式查询方式敏感；增加了控制线数，控制也较复杂。

* 独立请求方式：每台设备均有一对总线请求线和总线同意线，总线控制部件内部有排队电路。  
    响应速度快，优先次序控制灵活；控制线数量多，总线控制更复杂。

#### 分布仲裁方式
总线控制逻辑分散在总线各部件中。

### 总线操作和定时
#### 同步定时方式
总线上的部件通过总线进行信息传送时，用一个公共的时钟信号进行同步。具有较高的传输频率。  
适用于总线长度较短、各部件存取时间比较接近的情况。必须按最慢的部件设计公共时钟，如果各部件存取时间相差很大，也会大大损失总线效率。

#### 异步定时方式
适用于存取周期不同的部件之间的通信。

### 总线标准
ISA、EISA、VESA（LV-BUS）、PCI、AGP、RS-232、USB等  
PCI 总线已成为当代计算机中最常用的总线之一，特点有：
* 高性能。自身采用33 MHz 和66 MHz 的总线时钟，数据线可由32位扩展到64位，传输速率可由132 MBps 升级到528 MBps。
* 良好的兼容性。与 ISA、EISA 均可兼容。
* 支持即插即用（Plug and Play），即任何扩展卡只要插入系统便可工作。
* 支持多主设备能力。
* 具有与处理器和存储器子系统完全并行操作的能力。
* 提供数据和地址奇偶校验功能，保证了数据的完整和准确。
* 支持两种电压标准：5 V和3.3 V。
* 可扩展性好。当 PCI 总线驱动能力不足时，可采用多层结构。
* 软件兼容性好。
* 采用多路复用技术，减少总线引脚个数。